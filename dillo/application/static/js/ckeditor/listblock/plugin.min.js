CKEDITOR.plugins.add("listblock",{requires:"panel",onLoad:function(){var e=CKEDITOR.addTemplate("panel-list",'<ul role="presentation" class="cke_panel_list">{items}</ul>'),d=CKEDITOR.addTemplate("panel-list-item",'<li id="{id}" class="cke_panel_listItem" role=presentation><a id="{id}_option" _cke_focus=1 hidefocus=true title="{title}" href="javascript:void(\'{val}\')"  {onclick}="CKEDITOR.tools.callFunction({clickFn},\'{val}\'); return false;" role="option">{text}</a></li>'),a=CKEDITOR.addTemplate("panel-list-group",'<h1 id="{id}" class="cke_panel_grouptitle" role="presentation" >{label}</h1>'),c=/\'/g,b=function(f){return f.replace(c,"\\'")};CKEDITOR.ui.panel.prototype.addListBlock=function(f,g){return this.addBlock(f,new CKEDITOR.ui.listBlock(this.getHolderElement(),g))};CKEDITOR.ui.listBlock=CKEDITOR.tools.createClass({base:CKEDITOR.ui.panel.block,$:function(f,h){h=h||{};var i=h.attributes||(h.attributes={});(this.multiSelect=!!h.multiSelect)&&(i["aria-multiselectable"]=true);!i.role&&(i.role="listbox");this.base.apply(this,arguments);this.element.setAttribute("role",i.role);var g=this.keys;g[40]="next";g[9]="next";g[38]="prev";g[CKEDITOR.SHIFT+9]="prev";g[32]=CKEDITOR.env.ie?"mouseup":"click";CKEDITOR.env.ie&&(g[13]="mouseup");this._.pendingHtml=[];this._.pendingList=[];this._.items={};this._.groups={}},_:{close:function(){if(this._.started){var f=e.output({items:this._.pendingList.join("")});this._.pendingList=[];this._.pendingHtml.push(f);delete this._.started}},getClick:function(){if(!this._.click){this._.click=CKEDITOR.tools.addFunction(function(g){var f=this.toggle(g);if(this.onClick){this.onClick(g,f)}},this)}return this._.click}},proto:{add:function(h,f,i){var j=CKEDITOR.tools.getNextId();if(!this._.started){this._.started=1;this._.size=this._.size||0}this._.items[h]=j;var g={id:j,val:b(CKEDITOR.tools.htmlEncodeAttr(h)),onclick:CKEDITOR.env.ie?'onclick="return false;" onmouseup':"onclick",clickFn:this._.getClick(),title:CKEDITOR.tools.htmlEncodeAttr(i||h),text:f||h};this._.pendingList.push(d.output(g))},startGroup:function(f){this._.close();var g=CKEDITOR.tools.getNextId();this._.groups[f]=g;this._.pendingHtml.push(a.output({id:g,label:f}))},commit:function(){this._.close();this.element.appendHtml(this._.pendingHtml.join(""));delete this._.size;this._.pendingHtml=[]},toggle:function(g){var f=this.isMarked(g);if(f){this.unmark(g)}else{this.mark(g)}return !f},hideGroup:function(f){var h=this.element.getDocument().getById(this._.groups[f]),g=h&&h.getNext();if(h){h.setStyle("display","none");if(g&&g.getName()=="ul"){g.setStyle("display","none")}}},hideItem:function(f){this.element.getDocument().getById(this._.items[f]).setStyle("display","none")},showAll:function(){var g=this._.items,f=this._.groups,k=this.element.getDocument();for(var i in g){k.getById(g[i]).setStyle("display","")}for(var l in f){var j=k.getById(f[l]),h=j.getNext();j.setStyle("display","");if(h&&h.getName()=="ul"){h.setStyle("display","")}}},mark:function(g){if(!this.multiSelect){this.unmarkAll()}var h=this._.items[g],f=this.element.getDocument().getById(h);f.addClass("cke_selected");this.element.getDocument().getById(h+"_option").setAttribute("aria-selected",true);this.onMark&&this.onMark(f)},unmark:function(g){var h=this.element.getDocument(),i=this._.items[g],f=h.getById(i);f.removeClass("cke_selected");h.getById(i+"_option").removeAttribute("aria-selected");this.onUnmark&&this.onUnmark(f)},unmarkAll:function(){var f=this._.items,h=this.element.getDocument();for(var g in f){var i=f[g];h.getById(i).removeClass("cke_selected");h.getById(i+"_option").removeAttribute("aria-selected")}this.onUnmark&&this.onUnmark()},isMarked:function(f){return this.element.getDocument().getById(this._.items[f]).hasClass("cke_selected")},focus:function(k){this._.focusIndex=-1;var f=this.element.getElementsByTag("a"),j,h,g=-1;if(k){h=this.element.getDocument().getById(this._.items[k]).getFirst();while((j=f.getItem(++g))){if(j.equals(h)){this._.focusIndex=g;break}}}else{this.element.focus()}h&&setTimeout(function(){h.focus()},0)}}})}});