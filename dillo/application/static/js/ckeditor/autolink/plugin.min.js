CKEDITOR.plugins.add("autolink",{init:function(a){a.on("instanceReady",function(){var j=0;if(CKEDITOR.env.ie||(CKEDITOR.env.gecko&&CKEDITOR.env.version===110000)){return}var h=CKEDITOR.env.ie&&CKEDITOR.env.version=="6"?"\ufeff":"\u200B";var e=function(k,l){return k.nodeType==3&&!k.nodeValue.replace(new RegExp((l?"^":"")+h),"").length};var b=function(k){return k&&k.nodeType==1&&k.tagName.toLowerCase()=="body"};var d=function(k){return k?k.replace(/&((g|l|quo)t|amp|#39);/g,function(l){return{"&lt;":"<","&amp;":"&","&quot;":'"',"&gt;":">","&#39;":"'"}[l]}):""};var f=function(k){return Object.prototype.toString.apply(k)=="[object Array]"};var b=function(k){return k&&k.nodeType==1&&k.tagName.toLowerCase()=="body"};var g=function(m){if(!m){return{}}m=f(m)?m:m.split(",");for(var l=0,k,n={};k=m[l++];){n[k.toUpperCase()]=n[k]=1}return n};var i=function(l,m,k){if(l&&!b(l)){l=k?l:l.parentNode;while(l){if(!m||m(l)||b(l)){return m&&!m(l)&&b(l)?null:l}l=l.parentNode}}return null};var c=function(m,k,l,n){k=g(f(k)?k:[k]);return i(m,function(o){return k[o.tagName]&&!(n&&n(o))},l)};a.document.on("reset",function(){j=0});a.autolink=function(p){var m=a.getSelection().getNative(),o=m.getRangeAt(0).cloneRange(),n,s;var l=o.startContainer;while(l.nodeType==1&&o.startOffset>0){l=o.startContainer.childNodes[o.startOffset-1];if(!l){break}o.setStart(l,l.nodeType==1?l.childNodes.length:l.nodeValue.length);o.collapse(true);l=o.startContainer}do{if(o.startOffset==0){l=o.startContainer.previousSibling;while(l&&l.nodeType==1){if(CKEDITOR.env.gecko&&l.firstChild){l=l.firstChild}else{l=l.lastChild}}if(!l||e(l)){break}n=l.nodeValue.length}else{l=o.startContainer;n=o.startOffset}o.setStart(l,n-1);s=o.toString().charCodeAt(0)}while(s!=160&&s!=32);if(o.toString().replace(new RegExp(h,"g"),"").match(/(?:https?:\/\/|ssh:\/\/|ftp:\/\/|file:\/|www\.)/i)){while(o.toString().length){if(/^(?:https?:\/\/|ssh:\/\/|ftp:\/\/|file:\/|www\.)/i.test(o.toString())){break}try{o.setStart(o.startContainer,o.startOffset+1)}catch(p){var l=o.startContainer;while(!(next=l.nextSibling)){if(b(l)){return}l=l.parentNode}o.setStart(next,0)}}if(c(o.startContainer,"a",true)){return}var q=document.createElement("a"),r=document.createTextNode(" "),k;a.undoManger&&a.undoManger.save();q.appendChild(o.extractContents());q.href=q.innerHTML=q.innerHTML.replace(/<[^>]+>/g,"");k=q.getAttribute("href").replace(new RegExp(h,"g"),"");k=/^(?:https?:\/\/)/ig.test(k)?k:"http://"+k;q.setAttribute("_src",d(k));q.href=d(k);o.insertNode(q);q.parentNode.insertBefore(r,q.nextSibling);o.setStart(r.nextSibling,0);o.collapse(true);m.removeAllRanges();m.addRange(o);a.undoManger&&a.undoManger.save()}};if(CKEDITOR.env.webkit){a.on("key",function(k){if(k.data.keyCode===32||k.data.keyCode===13){a.autolink(k)}})}else{a.document.on("keypress",function(k){if(k.data.getKey()===32||k.data.getKey()===13){a.autolink(k)}})}})}});