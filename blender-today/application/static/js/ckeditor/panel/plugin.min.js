(function(){CKEDITOR.plugins.add("panel",{beforeInit:function(d){d.ui.addHandler(CKEDITOR.UI_PANEL,CKEDITOR.ui.panel.handler)}});CKEDITOR.UI_PANEL="panel";CKEDITOR.ui.panel=function(d,e){if(e){CKEDITOR.tools.extend(this,e)}CKEDITOR.tools.extend(this,{className:"",css:[]});this.id=CKEDITOR.tools.getNextId();this.document=d;this.isFramed=this.forceIFrame||this.css.length;this._={blocks:{}}};CKEDITOR.ui.panel.handler={create:function(d){return new CKEDITOR.ui.panel(d)}};var c=CKEDITOR.addTemplate("panel",'<div lang="{langCode}" id="{id}" dir={dir} class="cke cke_reset_all {editorId} cke_panel cke_panel {cls} cke_{dir}" style="z-index:{z-index}" role="presentation">{frame}</div>');var a=CKEDITOR.addTemplate("panel-frame",'<iframe id="{id}" class="cke_panel_frame" role="presentation" frameborder="0" src="{src}"></iframe>');var b=CKEDITOR.addTemplate("panel-frame-inner",'<!DOCTYPE html><html class="cke_panel_container {env}" dir="{dir}" lang="{langCode}"><head>{css}</head><body class="cke_{dir}" style="margin:0;padding:0" onload="{onload}"></body></html>');CKEDITOR.ui.panel.prototype={render:function(f,d){this.getHolderElement=function(){var i=this._.holder;if(!i){if(this.isFramed){var k=this.document.getById(this.id+"_frame"),n=k.getParent(),m=k.getFrameDocument();CKEDITOR.env.iOS&&n.setStyles({overflow:"scroll","-webkit-overflow-scrolling":"touch"});var j=CKEDITOR.tools.addFunction(CKEDITOR.tools.bind(function(){this.isLoaded=true;if(this.onLoad){this.onLoad()}},this));m.write(b.output(CKEDITOR.tools.extend({css:CKEDITOR.tools.buildStyleHtml(this.css),onload:"window.parent.CKEDITOR.tools.callFunction("+j+");"},g)));var l=m.getWindow();l.$.CKEDITOR=CKEDITOR;m.on("keydown",function(o){var q=o.data.getKeystroke(),p=this.document.getById(this.id).getAttribute("dir");if(this._.onKeyDown&&this._.onKeyDown(q)===false){o.data.preventDefault();return}if(q==27||q==(p=="rtl"?39:37)){if(this.onEscape&&this.onEscape(q)===false){o.data.preventDefault()}}},this);i=m.getBody();i.unselectable();CKEDITOR.env.air&&CKEDITOR.tools.callFunction(j)}else{i=this.document.getById(this.id)}this._.holder=i}return i};var g={editorId:f.id,id:this.id,langCode:f.langCode,dir:f.lang.dir,cls:this.className,frame:"",env:CKEDITOR.env.cssClass,"z-index":f.config.baseFloatZIndex+1};if(this.isFramed){var h=CKEDITOR.env.air?"javascript:void(0)":CKEDITOR.env.ie?"javascript:void(function(){"+encodeURIComponent("document.open();("+CKEDITOR.tools.fixDomain+")();document.close();")+"}())":"";g.frame=a.output({id:this.id+"_frame",src:h})}var e=c.output(g);if(d){d.push(e)}return e},addBlock:function(d,e){e=this._.blocks[d]=e instanceof CKEDITOR.ui.panel.block?e:new CKEDITOR.ui.panel.block(this.getHolderElement(),e);if(!this._.currentBlock){this.showBlock(d)}return e},getBlock:function(d){return this._.blocks[d]},showBlock:function(d){var h=this._.blocks,g=h[d],f=this._.currentBlock;var e=!this.forceIFrame||CKEDITOR.env.ie?this._.holder:this.document.getById(this.id+"_frame");if(f){f.hide()}this._.currentBlock=g;CKEDITOR.fire("ariaWidget",e);g._.focusIndex=-1;this._.onKeyDown=g.onKeyDown&&CKEDITOR.tools.bind(g.onKeyDown,g);g.show();return g},destroy:function(){this.element&&this.element.remove()}};CKEDITOR.ui.panel.block=CKEDITOR.tools.createClass({$:function(d,e){this.element=d.append(d.getDocument().createElement("div",{attributes:{tabindex:-1,"class":"cke_panel_block"},styles:{display:"none"}}));if(e){CKEDITOR.tools.extend(this,e)}this.element.setAttributes({role:this.attributes.role||"presentation","aria-label":this.attributes["aria-label"],title:this.attributes.title||this.attributes["aria-label"]});this.keys={};this._.focusIndex=-1;this.element.disableContextMenu()},_:{markItem:function(e){if(e==-1){return}var d=this.element.getElementsByTag("a");var f=d.getItem(this._.focusIndex=e);if(CKEDITOR.env.webkit){f.getDocument().getWindow().focus()}f.focus();this.onMark&&this.onMark(f)}},proto:{show:function(){this.element.setStyle("display","")},hide:function(){if(!this.onHide||this.onHide.call(this)!==true){this.element.setStyle("display","none")}},onKeyDown:function(i,e){var g=this.keys[i];switch(g){case"next":var f=this._.focusIndex,d=this.element.getElementsByTag("a"),h;while((h=d.getItem(++f))){if(h.getAttribute("_cke_focus")&&h.$.offsetWidth){this._.focusIndex=f;h.focus();break}}if(!h&&!e){this._.focusIndex=-1;return this.onKeyDown(i,1)}return false;case"prev":f=this._.focusIndex;d=this.element.getElementsByTag("a");while(f>0&&(h=d.getItem(--f))){if(h.getAttribute("_cke_focus")&&h.$.offsetWidth){this._.focusIndex=f;h.focus();break}h=null}if(!h&&!e){this._.focusIndex=d.count();return this.onKeyDown(i,1)}return false;case"click":case"mouseup":f=this._.focusIndex;h=f>=0&&this.element.getElementsByTag("a").getItem(f);if(h){h.$[g]?h.$[g]():h.$["on"+g]()}return false}return true}}})})();