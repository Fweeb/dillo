(function(){function b(e){for(var c=0,d=e.getChildCount(),f;c<d&&(f=e.getChild(c));c++){if(f.type==CKEDITOR.NODE_ELEMENT&&f.isBlockBoundary()){return false}}return true}var a={exec:function(h){var k=h.getCommand("blockquote").state,G=h.getSelection(),t=G&&G.getRanges()[0];if(!t){return}var l=G.createBookmarks();if(CKEDITOR.env.ie){var f=l[0].startNode,z=l[0].endNode,j;if(f&&f.getParent().getName()=="blockquote"){j=f;while((j=j.getNext())){if(j.type==CKEDITOR.NODE_ELEMENT&&j.isBlockBoundary()){f.move(j,true);break}}}if(z&&z.getParent().getName()=="blockquote"){j=z;while((j=j.getPrevious())){if(j.type==CKEDITOR.NODE_ELEMENT&&j.isBlockBoundary()){z.move(j);break}}}}var w=t.createIterator(),p;w.enlargeBr=h.config.enterMode!=CKEDITOR.ENTER_BR;if(k==CKEDITOR.TRISTATE_OFF){var q=[];while((p=w.getNextParagraph())){q.push(p)}if(q.length<1){var e=h.document.createElement(h.config.enterMode==CKEDITOR.ENTER_P?"p":"div"),g=l.shift();t.insertNode(e);e.append(new CKEDITOR.dom.text("\ufeff",h.document));t.moveToBookmark(g);t.selectNodeContents(e);t.collapse(true);g=t.createBookmark();q.push(e);l.unshift(g)}var r=q[0].getParent(),D=[];for(var A=0;A<q.length;A++){p=q[A];r=r.getCommonAncestor(p.getParent())}var B={table:1,tbody:1,tr:1,ol:1,ul:1};while(B[r.getName()]){r=r.getParent()}var C=null;while(q.length>0){p=q.shift();while(!p.getParent().equals(r)){p=p.getParent()}if(!p.equals(C)){D.push(p)}C=p}while(D.length>0){p=D.shift();if(p.getName()=="blockquote"){var d=new CKEDITOR.dom.documentFragment(h.document);while(p.getFirst()){d.append(p.getFirst().remove());q.push(d.getLast())}d.replace(p)}else{q.push(p)}}var x=h.document.createElement("blockquote");x.insertBefore(q[0]);while(q.length>0){p=q.shift();x.append(p)}}else{if(k==CKEDITOR.TRISTATE_ON){var E=[],s={};while((p=w.getNextParagraph())){var F=null,u=null;while(p.getParent()){if(p.getParent().getName()=="blockquote"){F=p.getParent();u=p;break}p=p.getParent()}if(F&&u&&!u.getCustomData("blockquote_moveout")){E.push(u);CKEDITOR.dom.element.setMarker(s,u,"blockquote_moveout",true)}}CKEDITOR.dom.element.clearAllMarkers(s);var c=[],o=[];s={};while(E.length>0){var y=E.shift();x=y.getParent();if(!y.getPrevious()){y.remove().insertBefore(x)}else{if(!y.getNext()){y.remove().insertAfter(x)}else{y.breakParent(y.getParent());o.push(y.getNext())}}if(!x.getCustomData("blockquote_processed")){o.push(x);CKEDITOR.dom.element.setMarker(s,x,"blockquote_processed",true)}c.push(y)}CKEDITOR.dom.element.clearAllMarkers(s);for(A=o.length-1;A>=0;A--){x=o[A];if(b(x)){x.remove()}}if(h.config.enterMode==CKEDITOR.ENTER_BR){var n=true;while(c.length){y=c.shift();if(y.getName()=="div"){d=new CKEDITOR.dom.documentFragment(h.document);var v=n&&y.getPrevious()&&!(y.getPrevious().type==CKEDITOR.NODE_ELEMENT&&y.getPrevious().isBlockBoundary());if(v){d.append(h.document.createElement("br"))}var m=y.getNext()&&!(y.getNext().type==CKEDITOR.NODE_ELEMENT&&y.getNext().isBlockBoundary());while(y.getFirst()){y.getFirst().remove().appendTo(d)}if(m){d.append(h.document.createElement("br"))}d.replace(y);n=false}}}}}G.selectBookmarks(l);h.focus()},refresh:function(c,e){var d=e.block||e.blockLimit;this.setState(c.elementPath(d).contains("blockquote",1)?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF)},context:"blockquote",allowedContent:"blockquote",requiredContent:"blockquote"};CKEDITOR.plugins.add("blockquote",{lang:"en",icons:"blockquote",hidpi:true,init:function(c){if(c.blockless){return}c.addCommand("blockquote",a);c.ui.addButton&&c.ui.addButton("Blockquote",{label:c.lang.blockquote.toolbar,command:"blockquote",toolbar:"blocks,10"})}})})();