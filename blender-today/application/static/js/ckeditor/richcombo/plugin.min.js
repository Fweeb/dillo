CKEDITOR.plugins.add("richcombo",{requires:"floatpanel,listblock,button",beforeInit:function(a){a.ui.addHandler(CKEDITOR.UI_RICHCOMBO,CKEDITOR.ui.richCombo.handler)}});(function(){var b='<span id="{id}" class="cke_combo cke_combo__{name} {cls}" role="presentation"><span id="{id}_label" class="cke_combo_label">{label}</span><a class="cke_combo_button" title="{title}" tabindex="-1"'+(CKEDITOR.env.gecko&&!CKEDITOR.env.hc?"":" href=\"javascript:void('{titleJs}')\"")+' hidefocus="true" role="button" aria-labelledby="{id}_label" aria-haspopup="true"';if(CKEDITOR.env.gecko&&CKEDITOR.env.mac){b+=' onkeypress="return false;"'}if(CKEDITOR.env.gecko){b+=' onblur="this.style.cssText = this.style.cssText;"'}b+=' onkeydown="return CKEDITOR.tools.callFunction({keydownFn},event,this);" onfocus="return CKEDITOR.tools.callFunction({focusFn},event);" '+(CKEDITOR.env.ie?'onclick="return false;" onmouseup':"onclick")+'="CKEDITOR.tools.callFunction({clickFn},this);return false;"><span id="{id}_text" class="cke_combo_text cke_combo_inlinelabel">{label}</span><span class="cke_combo_open"><span class="cke_combo_arrow">'+(CKEDITOR.env.hc?"&#9660;":CKEDITOR.env.air?"&nbsp;":"")+"</span></span></a></span>";var a=CKEDITOR.addTemplate("combo",b);CKEDITOR.UI_RICHCOMBO="richcombo";CKEDITOR.ui.richCombo=CKEDITOR.tools.createClass({$:function(c){CKEDITOR.tools.extend(this,c,{canGroup:false,title:c.label,modes:{wysiwyg:1},editorFocus:1});var d=this.panel||{};delete this.panel;this.id=CKEDITOR.tools.getNextNumber();this.document=(d.parent&&d.parent.getDocument())||CKEDITOR.document;d.className="cke_combopanel";d.block={multiSelect:d.multiSelect,attributes:d.attributes};d.toolbarRelated=true;this._={panelDefinition:d,items:{}}},proto:{renderHtml:function(d){var c=[];this.render(d,c);return c.join("")},render:function(i,g){var j=CKEDITOR.env;var e="cke_"+this.id;var c=CKEDITOR.tools.addFunction(function(o){if(l){i.unlockSelection(1);l=0}m.execute(o)},this);var f=this;var m={id:e,combo:this,focus:function(){var o=CKEDITOR.document.getById(e).getChild(1);o.focus()},execute:function(p){var o=f._;if(o.state==CKEDITOR.TRISTATE_DISABLED){return}f.createPanel(i);if(o.on){o.panel.hide();return}f.commit();var q=f.getValue();if(q){o.list.mark(q)}else{o.list.unmarkAll()}o.panel.showBlock(f.id,new CKEDITOR.dom.element(p),4)},clickFn:c};function n(){if(this.getState()==CKEDITOR.TRISTATE_ON){return}var o=this.modes[i.mode]?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED;if(i.readOnly&&!this.readOnly){o=CKEDITOR.TRISTATE_DISABLED}this.setState(o);this.setValue("");if(o!=CKEDITOR.TRISTATE_DISABLED&&this.refresh){this.refresh()}}i.on("activeFilterChange",n,this);i.on("mode",n,this);i.on("selectionChange",n,this);!this.readOnly&&i.on("readOnly",n,this);var k=CKEDITOR.tools.addFunction(function(p,o){p=new CKEDITOR.dom.event(p);var q=p.getKeystroke();if(q==40){i.once("panelShow",function(r){r.data._.panel._.currentBlock.onKeyDown(40)})}switch(q){case 13:case 32:case 40:CKEDITOR.tools.callFunction(c,o);break;default:m.onkey(m,q)}p.preventDefault()});var d=CKEDITOR.tools.addFunction(function(){m.onfocus&&m.onfocus()});var l=0;m.keyDownFn=k;var h={id:e,name:this.name||this.command,label:this.label,title:this.title,cls:this.className||"",titleJs:j.gecko&&!j.hc?"":(this.title||"").replace("'",""),keydownFn:k,focusFn:d,clickFn:c};a.output(h,g);if(this.onRender){this.onRender()}return m},createPanel:function(d){if(this._.panel){return}var j=this._.panelDefinition,i=this._.panelDefinition.block,h=j.parent||CKEDITOR.document.getBody(),f="cke_combopanel__"+this.name,c=new CKEDITOR.ui.floatPanel(d,h,j),g=c.addListBlock(this.id,i),e=this;c.onShow=function(){this.element.addClass(f);e.setState(CKEDITOR.TRISTATE_ON);e._.on=1;e.editorFocus&&!d.focusManager.hasFocus&&d.focus();if(e.onOpen){e.onOpen()}d.once("panelShow",function(){g.focus(!g.multiSelect&&e.getValue())})};c.onHide=function(k){this.element.removeClass(f);e.setState(e.modes&&e.modes[d.mode]?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED);e._.on=0;if(!k&&e.onClose){e.onClose()}};c.onEscape=function(){c.hide(1)};g.onClick=function(l,k){if(e.onClick){e.onClick.call(e,l,k)}c.hide()};this._.panel=c;this._.list=g;c.getBlock(this.id).onHide=function(){e._.on=0;e.setState(CKEDITOR.TRISTATE_OFF)};if(this.init){this.init()}},setValue:function(d,e){this._.value=d;var c=this.document.getById("cke_"+this.id+"_text");if(c){if(!(d||e)){e=this.label;c.addClass("cke_combo_inlinelabel")}else{c.removeClass("cke_combo_inlinelabel")}c.setText(typeof e!="undefined"?e:d)}},getValue:function(){return this._.value||""},unmarkAll:function(){this._.list.unmarkAll()},mark:function(c){this._.list.mark(c)},hideItem:function(c){this._.list.hideItem(c)},hideGroup:function(c){this._.list.hideGroup(c)},showAll:function(){this._.list.showAll()},add:function(d,c,e){this._.items[d]=e||d;this._.list.add(d,c,e)},startGroup:function(c){this._.list.startGroup(c)},commit:function(){if(!this._.committed){this._.list.commit();this._.committed=1;CKEDITOR.ui.fire("ready",this)}this._.committed=1},setState:function(d){if(this._.state==d){return}var c=this.document.getById("cke_"+this.id);c.setState(d,"cke_combo");d==CKEDITOR.TRISTATE_DISABLED?c.setAttribute("aria-disabled",true):c.removeAttribute("aria-disabled");this._.state=d},getState:function(){return this._.state},enable:function(){if(this._.state==CKEDITOR.TRISTATE_DISABLED){this.setState(this._.lastState)}},disable:function(){if(this._.state!=CKEDITOR.TRISTATE_DISABLED){this._.lastState=this._.state;this.setState(CKEDITOR.TRISTATE_DISABLED)}}},statics:{handler:{create:function(c){return new CKEDITOR.ui.richCombo(c)}}}});CKEDITOR.ui.prototype.addRichCombo=function(c,d){this.add(c,CKEDITOR.UI_RICHCOMBO,d)}})();