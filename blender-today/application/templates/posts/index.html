{% extends 'layout.html' %}
{% block body %}
<h3>All posts <small>({{posts|length}})</small></h3>

<div class="row post-index">
	<div class="col-md-9">
		{% for post in posts %}
		<div class="row post-index-item">
			<div class="col-md-2 col-sm-2 col-xs-2">
				<div class="post-index-item-rate">
					<a class="post-index-item-rate up{% if post.user_rating and post.user_rating.is_positive %} rated{% endif %}" href="{{url_for('posts.rate', uuid=post.uuid, rating='1')}}" title="Upvote, click again to undo">
						<span class="up"><i class="fa fa-angle-up"></i></span>
					</a>
					<span class="middle">{{post.rating.positive - post.rating.negative}}</span>
					<a class="post-index-item-rate down{% if post.user_rating and not post.user_rating.is_positive %} rated{% endif %}" href="{{url_for('posts.rate', uuid=post.uuid, rating='0')}}" title="Downvote, click again to undo">
						<span class="down"><i class="fa fa-angle-down"></i></span>
					</a>
				</div>
				<a href="{{url_for('posts.view', category=post.category.url, uuid=post.uuid, slug=post.slug)}}">
					<div class="post-index-item-type" title="{{post.rating.positive}} Upvotes, {{post.rating.negative}} Downvotes" {% if post.picture %}style="background: url({{post.thumbnail('s')}}) top left no-repeat"{% endif %}>
						{% if post.post_type.url == 'link' %}
							<i class="fa fa-link"></i>
						{% elif post.post_type.url == 'text' %}
							<i class="fa fa-file-text-o"></i>
						{% endif %}
					</div>
				</a>
			</div>

			<div class="col-md-10 col-sm-10 col-xs-10">

				<a class="post-index-item-title" href="{{url_for('posts.view', category=post.category.url, uuid=post.uuid, slug=post.slug)}}" title="{{post.title}}">
					{{post.title}}
				</a>

				<div class="post-index-item-details" href="{{url_for('posts.view', category=post.category.url, uuid=post.uuid, slug=post.slug)}}">
					{{post.post_type}}
					<span class="separator"></span>
					<a href="{{url_for('posts.view', category=post.category.url, uuid=post.uuid, slug=post.slug)}}#comments">
						{{post.comments|length}} comments
					</a>
					<span class="separator"></span>
					<span title="{{post.creation_date.strftime('%H:%M on %d %B, %Y')}}">
						{{post.pretty_creation_date}}
					</span>

					<small>by</small>
					<a href="{{url_for('posts.view', category=post.category.url, uuid=post.uuid, slug=post.slug)}}#comments">
						{{post.user.first_name}} {{post.user.last_name}}
					</a>

					{% if post.picture %}
					<span class="separator"></span>
					<span class="post-index-item-picture-collapse"><i class="fa fa-minus"></i></span>
					<span class="post-index-item-picture-expand"><i class="fa fa-picture-o"></i></span>
					<img class="post-index-item-picture"
							 title="Click and drag to resize"
							 data-rel="{{post.thumbnail('l')}}" src=""/>
					{% endif %}

				</div>
			</div>
		</div>
		{% endfor %}
	</div>
</div>
{% endblock %}

{% block footer_scripts %}
<script type="text/javascript">

	$('.post-index-item-picture-expand').click(function(){
		$(this).next($('.post-index-item-picture')).attr('src', $(this).next().data('rel'));
		$(this).next($('.post-index-item-picture')).css('display', 'block');
		$(this).next($('.post-index-item-picture')).animate({'opacity': 1.0});
		$(this).fadeOut(function(){
			$(this).prev().fadeIn();
		});
	});

	$('.post-index-item-picture-collapse').click(function(){
		$(this).next().next().fadeOut('fast');
		$(this).fadeOut(function(){
			$(this).next().fadeIn();
		});
	});

	$('.post-index-item-picture').mousedown(function(e){
		e.preventDefault();

		image = $(this);

		$(document).mousemove(function(e){
			e.preventDefault();
			var x = ((e.pageX - image.parent().offset().left) + (image.width())) * 0.6;
			$(image).css("width", x);
		})
	});

	$(document).mouseup(function(e){
		$(document).unbind('mousemove');
	});

</script>
{% endblock %}
