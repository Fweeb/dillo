{% extends 'layout.html' %}
{% block body %}
<h3>All posts <small>({{posts|length}})</small></h3>

<div class="row post-index">
	<div class="col-md-9">
		{% for post in posts %}
		<div class="row post-index-item">
			<div class="col-md-1 col-sm-1 col-xs-2">
				<a href="{{url_for('posts.view', category=post.category.url, uuid=post.uuid)}}">
					<div class="post-index-item-type" title="{{post.rating.positive}} Upvotes, {{post.rating.negative}} Downvotes" {% if post.picture %}style="background: url({{post.thumbnail('s')}}) top left no-repeat"{% endif %}>
						{% if post.post_type.url == 'link' %}
							<i class="fa fa-link"></i>
						{% elif post.post_type.url == 'text' %}
							<i class="fa fa-file-text-o"></i>
						{% endif %}
					</div>
				</a>
			</div>
			<div class="col-md-11 col-sm-11 col-xs-10">
				<a class="post-index-item-title" href="{{url_for('posts.view', category=post.category.url, uuid=post.uuid)}}">
					{% if post.picture %}<i class="fa fa-picture-o"></i> {% endif %}
					{{post.title}}
				</a>
				<div class="post-index-item-details" href="{{url_for('posts.view', category=post.category.url, uuid=post.uuid)}}">
					<a class="post-index-item-rate up{% if post.user_rating and post.user_rating.is_positive %} rated{% endif %}" href="{{url_for('posts.rate', uuid=post.uuid, rating='1')}}" title="Upvote, click again to undo">
						<i class="fa fa-arrow-up"></i>
					</a>
					<a class="post-index-item-rate down{% if post.user_rating and not post.user_rating.is_positive %} rated{% endif %}" href="{{url_for('posts.rate', uuid=post.uuid, rating='0')}}" title="Downvote, click again to undo">
						<i class="fa fa-arrow-down"></i>
					</a>
					<span class="separator"></span>
					{{post.rating.positive - post.rating.negative}}
					<span class="separator"></span>
					{{post.post_type}}
					<span class="separator"></span>
					{{post.comments|length}} comments
					<span class="separator"></span>
					{{post.pretty_creation_date}}
					<small>by</small> {{post.user.first_name}} {{post.user.last_name}}
					{% if post.picture %}
					<span class="separator"></span>
					<span class="post-index-item-picture-expand"><i class="fa fa-plus"></i></span>
					<img class="post-index-item-picture" data-rel="{{post.thumbnail('l')}}"  src=""/>
					{% endif %}
				</div>
			</div>
		</div>
		{% endfor %}
	</div>
</div>
{% endblock %}

{% block footer_scripts %}
<script type="text/javascript">
	$('.post-index-item-picture-expand').click(function(){
		$(this).next().attr('src', $(this).next().data('rel'));
		$(this).next().css('display', 'block');
		$(this).next().animate({'opacity': 1.0});
	});

	$('.post-index-item-picture').mousedown(function(e){
		e.preventDefault();

		image = $(this);

		$(document).mousemove(function(e){
			e.preventDefault();
			var x = ((e.pageX - image.parent().offset().left) + (image.width())) * 0.6;
			$(image).css("width", x);
		})
	});

	$(document).mouseup(function(e){
		$(document).unbind('mousemove');
	});

</script>
{% endblock %}
